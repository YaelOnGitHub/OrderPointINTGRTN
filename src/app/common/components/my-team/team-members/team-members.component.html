<div class="team-members-section">
  <div class="team-memeber-header">
    <span class="section-title">
      {{ ('teamsPage.teamTable.title' | translate) }} <span class="count">({{ teamMembers.length }})</span>
    </span>

    <div class="search-details table-header">
      <input type="text" [placeholder]="('teamsPage.teamTable.searchText' | translate)" (input)="onSearch($event)">
      <svg class="with-icon" width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"
        (click)="onSearch($event)">
        <path
          d="M16.7296 15.2779L10.9562 10.1815C10.821 10.0624 10.6859 9.94317 10.5561 9.81951C10.5392 9.80363 10.5223 9.78825 10.5054 9.77305C12.4715 7.43569 12.3551 3.94199 10.1552 1.74215C9.03956 0.626658 7.52648 0 5.94881 0C4.37113 0 2.85806 0.626658 1.74238 1.74215C-0.580792 4.06548 -0.580792 7.83218 1.74238 10.155C2.79448 11.2071 4.20264 11.8268 5.68912 11.8918C7.17561 11.9568 8.63249 11.4625 9.77244 10.5062C9.78747 10.5231 9.80268 10.54 9.81839 10.5555C9.93782 10.6812 10.053 10.8108 10.1677 10.9409L15.2778 16.7297C15.2963 16.7511 15.3161 16.7715 15.3369 16.7907C15.7047 17.1196 16.3375 17.0421 16.6897 16.6893C17.042 16.3371 17.1195 15.7043 16.7911 15.3365C16.7717 15.3158 16.7512 15.2963 16.7296 15.2779ZM2.33938 9.55817C1.8654 9.08418 1.48941 8.52148 1.23289 7.90219C0.976376 7.2829 0.844347 6.61915 0.844347 5.94883C0.844347 5.27851 0.976376 4.61476 1.23289 3.99547C1.48941 3.37618 1.8654 2.81348 2.33938 2.33949C2.81337 1.86551 3.37607 1.48952 3.99536 1.233C4.61465 0.976484 5.27841 0.844456 5.94872 0.844456C6.61904 0.844456 7.28279 0.976484 7.90208 1.233C8.52137 1.48952 9.08408 1.86551 9.55806 2.33949C10.032 2.81348 10.408 3.37618 10.6645 3.99547C10.9211 4.61476 11.0531 5.27851 11.0531 5.94883C11.0531 6.61915 10.9211 7.2829 10.6645 7.90219C10.408 8.52148 10.032 9.08418 9.55806 9.55817C9.08407 10.0322 8.52137 10.4081 7.90208 10.6647C7.28279 10.9212 6.61904 11.0532 5.94872 11.0532C5.27841 11.0532 4.61465 10.9212 3.99536 10.6647C3.37607 10.4081 2.81337 10.0322 2.33938 9.55817Z"
          fill="#E65E1D" />
      </svg>
    </div>
  </div>
  <div class="table-container">
    <table class="team-table">
      <thead>
        <tr>
          <th class="sales-rep-col" (click)="sortTable('Rep_FirstName')">
            {{ ('teamsPage.teamTable.columns' | translate)[0] }}
            <button class="sort-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path *ngIf="sortColumn === 'Rep_FirstName' && sortDirection === 'asc'" d="M7 14l5-5 5 5"></path>
                <path *ngIf="sortColumn === 'Rep_FirstName' && sortDirection === 'desc'" d="M7 10l5 5 5-5"></path>
                <path *ngIf="sortColumn !== 'Rep_FirstName'" d="M7 10l5 5 5-5"></path>
              </svg>

            </button>
          </th>
          <th class="product-id-col" (click)="sortTable('TerritoryId')">
            {{ ('teamsPage.teamTable.columns' | translate)[1] }}
            <button class="sort-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path *ngIf="sortColumn === 'TerritoryId' && sortDirection === 'asc'" d="M7 14l5-5 5 5"></path>
                <path *ngIf="sortColumn === 'TerritoryId' && sortDirection === 'desc'" d="M7 10l5 5 5-5"></path>
                <path *ngIf="sortColumn !== 'TerritoryId'" d="M7 10l5 5 5-5"></path>
              </svg>

            </button>
          </th>
          <th class="quantity-col" (click)="sortTable('TotalLimit')">
            {{ ('teamsPage.teamTable.columns' | translate)[2] }}
            <button class="sort-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path *ngIf="sortColumn === 'TotalLimit' && sortDirection === 'asc'" d="M7 14l5-5 5 5"></path>
                <path *ngIf="sortColumn === 'TotalLimit' && sortDirection === 'desc'" d="M7 10l5 5 5-5"></path>
                <path *ngIf="sortColumn !== 'TotalLimit'" d="M7 10l5 5 5-5"></path>
              </svg>

            </button>
          </th>
          <th class="usage-col op-usage" (click)="sortTable('OpUsage')">
            {{ ('teamsPage.teamTable.columns' | translate)[3] }}
            <button class="sort-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path *ngIf="sortColumn === 'OpUsage' && sortDirection === 'asc'" d="M7 14l5-5 5 5"></path>
                <path *ngIf="sortColumn === 'OpUsage' && sortDirection === 'desc'" d="M7 10l5 5 5-5"></path>
                <path *ngIf="sortColumn !== 'OpUsage'" d="M7 10l5 5 5-5"></path>
              </svg>

            </button>
          </th>
          <th *ngIf="dtpRuleEnabled" class="usage-col" (click)="sortTable('DtpUsage')">
            {{ ('teamsPage.teamTable.columns' | translate)[4] }}
            <button class="sort-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path *ngIf="sortColumn === 'DtpUsage' && sortDirection === 'asc'" d="M7 14l5-5 5 5"></path>
                <path *ngIf="sortColumn === 'DtpUsage' && sortDirection === 'desc'" d="M7 10l5 5 5-5"></path>
                <path *ngIf="sortColumn !== 'DtpUsage'" d="M7 10l5 5 5-5"></path>
              </svg>

            </button>
          </th>
          <th class="total-usage-col">
            {{ ('teamsPage.teamTable.columns' | translate)[5] }}
            <!-- <button class="sort-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path *ngIf="sortColumn === 'name' && sortDirection === 'asc'" d="M7 14l5-5 5 5"></path>
                        <path *ngIf="sortColumn === 'name' && sortDirection === 'desc'" d="M7 10l5 5 5-5"></path>
                        <path *ngIf="sortColumn !== 'name'" d="M7 10l5 5 5-5"></path>
                      </svg>
                      
                </button> -->
          </th>
          <th class="quantity-col" (click)="sortTable('OnHandQty')">
            {{ ('teamsPage.teamTable.columns' | translate)[6] }}
            <button class="sort-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path *ngIf="sortColumn === 'OnHandQty' && sortDirection === 'asc'" d="M7 14l5-5 5 5"></path>
                <path *ngIf="sortColumn === 'OnHandQty' && sortDirection === 'desc'" d="M7 10l5 5 5-5"></path>
                <path *ngIf="sortColumn !== 'OnHandQty'" d="M7 10l5 5 5-5"></path>
              </svg>

            </button>
          </th>
          <th *ngIf="dtpRuleEnabled" class="action-col">{{ ('teamsPage.teamTable.columns' | translate)[7] }}
          </th>
        </tr>
      </thead>

      <tbody *ngIf="filteredMembers && filteredMembers.length > 0">
        <tr class="district-row">
          <td>{{ managerName }}</td>
          <td>{{ territoryId }}</td>
          <td>{{ totalAllocated }}</td>
          <td>{{ totalHandCarry }}</td>
          <td *ngIf="dtpRuleEnabled">{{ totalDTP }}</td>

          <td *ngIf="dtpRuleEnabled">{{ totalHandCarry + totalDTP }}/ {{remainingAllocation}}</td>
          <td *ngIf="!dtpRuleEnabled">{{ totalHandCarry }}/ {{remainingAllocation}}</td>
          <td>{{ totalOnHand }}</td>
          <td *ngIf="dtpRuleEnabled"></td>
        </tr>

        <tr *ngFor="let member of filteredMembers" class="member-row">
          <td class="sales-rep-col">
            <div class="member-info">
              <div class="member-name">{{ member.Rep_FirstName }} {{ member.Rep_LastName }}</div>
              <div class="member-handle">{{ member.RepRosterId }}</div>
            </div>
            <div *ngIf="member.hasAlert" class="alert-icon">
              <span class="info-icon" title="More information">
                <i class="fa fa-info-circle"></i>
              </span>
            </div>
          </td>

          <td class="product-id-col">{{ member.TerritoryId }}</td>
          <td class="quantity-col">{{ member.TotalLimit }}</td>
          <td class="usage-col">{{ member.OpUsage }}</td>
          <td *ngIf="dtpRuleEnabled" class="usage-col">{{ member.DtpUsage }}</td>

          <td class="total-usage-col">
            <div class="usage-info">
              <!-- <span class="usage-value">{{ member.totalUsage }}</span> -->
              <div class="progress-bar">
                <div class="progress-fill" [ngStyle]="{
                      'width': ((member.totalUsage / member.quantityAllocated * 100)+5) + '%'
                    }"> {{ member.OpUsage + member.DtpUsage }}</div>
                {{ member.RemainingBalance }}
              </div>
              <!-- <span class="remaining-value"></span> -->
            </div>
          </td>

          <td class="quantity-col">{{ member.OnHandQty }}</td>
          <td *ngIf="dtpRuleEnabled" class="action-col">
            <button class="transfer-btn btn-primary" (click)="transferAllocation(member)">{{ ('teamsPage.teamTable.action' | translate) }}</button>
          </td>
        </tr>
      </tbody>

      <tbody *ngIf="!filteredMembers || filteredMembers.length === 0">
        <tr>
          <td colspan="9" class="no-data-cell">
            {{ ('teamsPage.teamTable.noData' | translate) }}
          </td>
        </tr>
      </tbody>

    </table>
  </div>
</div>