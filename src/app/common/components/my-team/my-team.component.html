<div class="dashboard-container">
  <!-- Header -->
  <header class="header-items">
    <div class="header-left">
      <h1 class="logo">{{ ('teamsPage.mainTitle' | translate) }}</h1>
      <p>{{('teamsPage.subTitle' | translate)}}</p>
    </div>


  </header>

  <!-- Dashboard Content -->
  <div class="dashboard-content">

    <div class="row">
      <!-- Product dropdown -->
      <div class="form-box col-md-6">
        <div class="title" ngbDropdown>
          <div class="select-dropdown" ngbDropdownToggle>
            <span>{{ selectedType ? selectedType : ('teamsPage.searchProduct' | translate)}}</span>
          </div>
          <div ngbDropdownMenu aria-labelledby="dropdownBasic1" class="item-menu">
            <button ngbDropdownItem class="item-num" *ngFor="let prod of productTypes" (click)="selectOrderType(prod) ">
              <span>{{prod.name}}</span>
            </button>
          </div>
        </div>
      </div>



      <div class="period-selector col-md-6">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <span>{{ ('teamsPage.datePeriod' | translate) }}</span>
        <span class="period-dates">{{ periodStart }} - {{ periodEnd }}</span>
      </div>

    </div>
    <div class="container-fluid py-3" *ngIf="!isProductSelected">
      <div class="row">
        <!-- Product Info Card -->
        <div class="col-md-3" [ngClass]="dtpRuleEnabled ? 'col-md-3' : 'col-md-4'">
          <div class="card prod-info-card">
            <ng-container *ngIf="isProductInfoAvailable(); else noProductData">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <div class="product-id">ID {{productInfo.id}}</div>
                  <div class="product-data-row">
                    <img [src]="productInfo.previewURL" [srcDefault]="'assets/img/home/Product_Default.svg'"
                      alt="Product" class="product-img" />
                    <h5 class="card-title mt-2 mb-1">{{productInfo.brand}}</h5>
                  </div>
                </div>
              </div>
              <p class="card-text mt-3 small">{{productInfo.name}}</p>
              <span class="text-muted small"> {{ ('teamsPage.productUnit' | translate) }}: <span
                  class="fw-bold">{{productInfo.unitsPerPackage}}</span></span>
            </ng-container>

            <ng-template #noProductData>
              <div class="text-center text-muted py-4">{{ ('teamsPage.productNoData' | translate) }} </div>
            </ng-template>
          </div>
        </div>

        <!-- Product Usage Chart -->
        <div *ngIf="dtpRuleEnabled" class="col-md-3 ">
          <div class="card chart-body">
            <div class="card-body">
              <div class="d-flex mb-1 card-title-header">
                <svg width="20" height="35" viewBox="0 0 12 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M4.94845 0.575433C3.65052 1.03511 2.82579 2.5223 3.12323 3.88782C3.28548 4.65845 4.02908 5.59133 4.69156 5.86172L5.13773 6.051V7.07852C5.13773 8.07899 5.15125 8.10603 5.44869 8.02491C5.61093 7.98435 5.90837 7.94379 6.12469 7.94379C6.48974 7.94379 6.48974 7.93027 6.48974 7.065V6.1862L7.09814 5.90228C8.15271 5.40205 8.78815 4.41509 8.78815 3.25238C8.78815 2.00855 7.88231 0.818792 6.67902 0.521354C5.93541 0.332075 5.59741 0.345594 4.94845 0.575433ZM6.55734 1.91391C7.72006 2.40062 7.69302 4.07709 6.51678 4.64493C5.55685 5.09109 4.46172 4.38805 4.46172 3.31998C4.46172 2.64398 4.63748 2.3195 5.17829 1.99503C5.69205 1.67055 5.94893 1.65703 6.55734 1.91391Z"
                    fill="#456386" />
                  <path
                    d="M3.17722 11.2039C1.69001 12.0421 0.365042 12.8127 0.243362 12.9209C0.0270402 13.1102 0 13.4482 0 16.3279C0 19.2077 0.0270402 19.5457 0.243362 19.7485C0.567844 20.0459 5.8542 23.0879 6.02996 23.0879C6.27332 23.0879 11.5326 19.9918 11.7354 19.7485C11.8571 19.5862 11.8977 18.6804 11.8977 16.3685C11.8977 13.5293 11.8706 13.1913 11.6543 12.975C11.3839 12.7181 6.1922 9.70316 6.00292 9.70316C5.93532 9.70316 4.66443 10.3792 3.17722 11.2039ZM7.86869 12.0827C8.89622 12.7181 9.7615 13.2859 9.78854 13.34C9.8291 13.3941 8.99086 13.9484 7.93629 14.5839L6.01644 15.733L4.00195 14.5298C2.59586 13.678 2.05505 13.2859 2.17673 13.2048C2.28489 13.1507 3.1637 12.6099 4.12363 12.0151C5.09707 11.4202 5.90828 10.9335 5.93532 10.9335C5.96236 10.92 6.82764 11.4472 7.86869 12.0827ZM3.38002 15.4897L5.34043 16.6794L5.381 19.086C5.39452 20.4109 5.36748 21.4655 5.29987 21.4385C5.24579 21.4249 4.29939 20.8841 3.20426 20.2487L1.23033 19.0995L1.21681 16.693C1.21681 15.3815 1.25737 14.2999 1.32497 14.3135C1.37905 14.3135 2.29841 14.8407 3.38002 15.4897ZM10.6809 16.72V19.1401L8.70694 20.3028C7.62533 20.9382 6.70596 21.4655 6.67892 21.4655C6.65188 21.4655 6.63836 20.3839 6.65188 19.0725L6.69244 16.6794L8.65286 15.4897C9.73446 14.8407 10.6268 14.3135 10.6538 14.3135C10.6673 14.2999 10.6809 15.3951 10.6809 16.72Z"
                    fill="#456386" />
                  <path
                    d="M5.27287 25.7503V26.7102L4.8267 26.8589C3.8803 27.1699 3.06909 28.4002 3.06909 29.5088C3.08261 31.9965 5.90831 33.2944 7.80112 31.672C9.31537 30.3741 9.03145 27.9405 7.26032 27.0076L6.62487 26.6696V25.7233V24.7769H5.94887H5.27287V25.7503ZM7.00344 28.576C7.5172 29.1168 7.57128 29.6846 7.16568 30.3471C6.82768 30.9149 6.01647 31.1853 5.40807 30.9284C4.11014 30.3876 4.13718 28.4813 5.44863 28.1028C6.08407 27.927 6.50319 28.0622 7.00344 28.576Z"
                    fill="#456386" />
                </svg>
                <span class="card-title mb-0">{{ ('teamsPage.titles' | translate)[0] }}</span>
              </div>
              <div class="chart-container">
                <canvas id="usageChart" height="auto"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Product on hand Allocation Chart -->
        <div class="col-md-3" [ngClass]="dtpRuleEnabled ? 'col-md-3' : 'col-md-4'">
          <div class="card chart-body">
            <div class="card-body">
              <div class="d-flex mb-1 card-title-header">
                <svg width="29" height="33" viewBox="0 0 29 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M13.331 0.575433C12.0331 1.03511 11.2084 2.5223 11.5058 3.88782C11.668 4.65845 12.4116 5.59133 13.0741 5.86172L13.5203 6.051V7.07852C13.5203 8.07899 13.5338 8.10603 13.8313 8.02491C13.9935 7.98435 14.2909 7.94379 14.5073 7.94379C14.8723 7.94379 14.8723 7.93027 14.8723 7.065V6.1862L15.4807 5.90228C16.5353 5.40205 17.1707 4.41509 17.1707 3.25238C17.1707 2.00855 16.2649 0.818792 15.0616 0.521354C14.318 0.332075 13.98 0.345594 13.331 0.575433ZM14.9399 1.91391C16.1026 2.40062 16.0756 4.07709 14.8993 4.64493C13.9394 5.09109 12.8443 4.38805 12.8443 3.31998C12.8443 2.64398 13.0201 2.3195 13.5609 1.99503C14.0746 1.67055 14.3315 1.65703 14.9399 1.91391Z"
                    fill="#456386" />
                  <path
                    d="M1.69006 7.21477C0.608451 7.80964 0.0135675 8.76956 4.74343e-05 9.94579C-0.0134727 12.3523 2.86631 13.6908 4.66448 12.1225L5.13768 11.7034L5.90833 12.1766C6.61137 12.6092 6.70601 12.6363 6.81417 12.4335C6.88177 12.3118 7.04401 12.0414 7.17921 11.8521L7.42257 11.5006L6.62489 11.0409L5.81368 10.5812V9.89171C5.81368 8.97236 5.29992 7.95836 4.56984 7.45813C4.11015 7.13365 3.85327 7.06605 3.05559 7.02549C2.36606 6.99845 1.9875 7.05253 1.69006 7.21477ZM3.90735 8.70196C5.25936 9.83763 3.77215 11.9603 2.1903 11.1355C1.32502 10.6894 1.17629 9.41852 1.90638 8.74252C2.47422 8.21524 3.31247 8.20172 3.90735 8.70196Z"
                    fill="#456386" />
                  <path
                    d="M24.5389 7.1873C23.5249 7.63345 22.7813 8.90433 22.8759 10.04L22.9165 10.6754L22.0782 11.1351L21.24 11.6083L21.578 12.095C21.7538 12.3654 21.9025 12.6358 21.9025 12.7034C21.9025 12.771 22.2946 12.6088 22.7678 12.3384L23.633 11.8517L24.1333 12.1897C26.0126 13.4741 28.5814 12.1221 28.5679 9.85072C28.5679 8.63393 27.9324 7.64697 26.8779 7.20082C26.2695 6.95746 25.0932 6.94394 24.5389 7.1873ZM26.648 8.62041C27.0671 8.93137 27.324 9.60736 27.2159 10.1617C27.1077 10.6754 26.3235 11.3244 25.7827 11.3244C24.3767 11.3244 23.6871 9.59384 24.7552 8.70153C25.2825 8.25537 26.0802 8.22833 26.648 8.62041Z"
                    fill="#456386" />
                  <path
                    d="M11.5598 11.2039C10.0726 12.0421 8.74761 12.8127 8.62593 12.9209C8.40961 13.1102 8.38257 13.4482 8.38257 16.3279C8.38257 19.2077 8.40961 19.5457 8.62593 19.7485C8.95041 20.0459 14.2368 23.0879 14.4125 23.0879C14.6559 23.0879 19.9152 19.9918 20.118 19.7485C20.2397 19.5862 20.2802 18.6804 20.2802 16.3685C20.2802 13.5293 20.2532 13.1913 20.0369 12.975C19.7665 12.7181 14.5748 9.70316 14.3855 9.70316C14.3179 9.70316 13.047 10.3792 11.5598 11.2039ZM16.2513 12.0827C17.2788 12.7181 18.1441 13.2859 18.1711 13.34C18.2117 13.3941 17.3734 13.9484 16.3189 14.5839L14.399 15.733L12.3845 14.5298C10.9784 13.678 10.4376 13.2859 10.5593 13.2048C10.6675 13.1507 11.5463 12.6099 12.5062 12.0151C13.4796 11.4202 14.2908 10.9335 14.3179 10.9335C14.3449 10.92 15.2102 11.4472 16.2513 12.0827ZM11.7626 15.4897L13.723 16.6794L13.7636 19.086C13.7771 20.4109 13.75 21.4655 13.6824 21.4385C13.6284 21.4249 12.682 20.8841 11.5868 20.2487L9.6129 19.0995L9.59938 16.693C9.59938 15.3815 9.63994 14.2999 9.70754 14.3135C9.76162 14.3135 10.681 14.8407 11.7626 15.4897ZM19.0634 16.72V19.1401L17.0895 20.3028C16.0079 20.9382 15.0885 21.4655 15.0615 21.4655C15.0345 21.4655 15.0209 20.3839 15.0345 19.0725L15.075 16.6794L17.0354 15.4897C18.117 14.8407 19.0094 14.3135 19.0364 14.3135C19.0499 14.2999 19.0634 15.3951 19.0634 16.72Z"
                    fill="#456386" />
                  <path
                    d="M5.90834 20.3152C5.4757 20.5721 5.07009 20.7884 4.98897 20.7884C4.92137 20.7884 4.67801 20.6532 4.46169 20.4909C3.97497 20.1394 2.69056 20.0042 1.97399 20.2476C-0.202742 20.9641 -0.581304 23.9656 1.32503 25.3175C1.86583 25.6826 2.01455 25.7231 2.96096 25.7231C3.89385 25.7231 4.06961 25.6826 4.56985 25.3311C5.38105 24.7767 5.86778 23.7357 5.78666 22.7488L5.71906 22.0052L6.43562 21.586C7.28739 21.0993 7.38203 20.9777 7.13867 20.6937C7.04403 20.5721 6.90882 20.3287 6.8277 20.1529L6.6925 19.842L5.90834 20.3152ZM3.75864 21.6807C4.11017 21.924 4.46169 22.5595 4.46169 22.9516C4.46169 23.4112 4.08313 24.0061 3.65048 24.236C2.09567 25.0471 0.662544 23.1138 1.90639 21.8835C2.23087 21.5455 2.43368 21.4644 2.89336 21.4644C3.20432 21.4644 3.5964 21.559 3.75864 21.6807Z"
                    fill="#456386" />
                  <path
                    d="M21.6998 20.4774C21.5511 20.7613 21.443 21.0317 21.4294 21.0993C21.4294 21.1534 21.7674 21.3968 22.173 21.6401L22.9031 22.0863L22.8626 22.7758C22.795 24.0332 23.6332 25.2635 24.8095 25.6556C25.6072 25.9124 26.6888 25.7637 27.3512 25.304C29.2441 23.9656 28.852 20.9641 26.6888 20.2476C25.9181 19.9907 24.7013 20.1394 24.1199 20.545L23.6332 20.8965L22.8491 20.4369C22.4164 20.18 22.0378 19.9772 22.0108 19.9772C21.9702 19.9772 21.835 20.207 21.6998 20.4774ZM26.7564 21.87C27.3648 22.4784 27.3918 23.3437 26.8375 23.952C25.864 25.0066 24.0659 24.1684 24.2551 22.7488C24.4039 21.532 25.8911 21.0182 26.7564 21.87Z"
                    fill="#456386" />
                  <path
                    d="M13.6554 25.7503V26.7102L13.2093 26.8589C12.2629 27.1699 11.4517 28.4002 11.4517 29.5088C11.4652 31.9965 14.2909 33.2944 16.1837 31.672C17.6979 30.3741 17.414 27.9405 15.6429 27.0076L15.0074 26.6696V25.7233V24.7769H14.3314H13.6554V25.7503ZM15.386 28.576C15.8998 29.1168 15.9538 29.6846 15.5482 30.3471C15.2102 30.9149 14.399 31.1853 13.7906 30.9284C12.4927 30.3876 12.5197 28.4813 13.8312 28.1028C14.4666 27.927 14.8858 28.0622 15.386 28.576Z"
                    fill="#456386" />
                </svg>
                <span class="card-title mb-0">{{ ('teamsPage.titles' | translate)[1] }}</span>
              </div>
              <div class="chart-container">
                <canvas id="allocationChart" height="auto"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-3" [ngClass]="dtpRuleEnabled ? 'col-md-3' : 'col-md-4'">
          <div class="card">
            <div class="product-data">
              <div class="card-header card-title-header">
                <svg width="28" height="31" viewBox="0 0 28 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M2.02561 15.0009C1.87553 15.0876 1.8667 15.4922 1.8667 21.2818C1.8667 25.9732 1.89319 27.5049 1.97264 27.5916C2.13156 27.765 6.30667 27.7554 6.4391 27.582C6.5009 27.5145 6.55387 26.9462 6.5627 26.3007L6.58919 25.1544L7.35728 25.1255L8.12537 25.0966L11.0653 26.4741L14.0052 27.8421L14.8881 27.8806C16.1771 27.9384 16.4684 27.8035 19.2053 25.9058C20.4766 25.0292 22.4543 23.6612 23.6196 22.852C24.7938 22.0332 25.8003 21.2722 25.9063 21.118C26.127 20.7712 26.2064 19.9235 26.0563 19.5189C25.8003 18.8446 24.9439 18.3629 24.3348 18.5459C24.1758 18.5941 23.1959 19.1625 22.1717 19.7983C21.1564 20.4437 20.2824 20.9639 20.2294 20.9639C20.1853 20.9639 20.0794 20.829 19.9911 20.6653C19.9028 20.5015 19.6909 20.2799 19.5231 20.1643C19.223 19.962 19.0994 19.9524 16.4684 19.9042C14.6586 19.8753 13.6786 19.8175 13.5991 19.7501C10.3414 16.9468 10.4738 17.0142 8.09006 16.9275L6.58919 16.8697L6.5627 16.0124C6.54504 15.5307 6.49207 15.0876 6.4391 15.0202C6.32433 14.866 2.26399 14.8371 2.02561 15.0009ZM5.8829 21.3011V26.8884H3.63159C1.88352 26.8884 2.52885 26.8595 2.53768 26.7631C2.5465 26.7053 2.55533 24.1718 2.56416 21.1566L2.57299 15.6656L3.65808 15.6848L5.8829 15.7137V21.3011ZM9.7675 17.8331C10.4208 18.0257 10.6592 18.1799 12.0188 19.3744C12.628 19.8946 13.2636 20.4052 13.4314 20.5015C13.6962 20.6556 14.0141 20.6749 16.3537 20.6749H18.9758L19.2495 20.9254C19.4878 21.1373 19.5231 21.2336 19.5231 21.6479V22.1199L16.2919 22.1392C13.3166 22.1681 13.0429 22.1777 12.9546 22.3318C12.884 22.4571 12.884 22.5534 12.9546 22.669C13.0429 22.8328 13.3254 22.8424 16.5214 22.8713C19.0111 22.8809 20.0264 22.8617 20.1058 22.7846C20.1765 22.7268 20.2294 22.5149 20.2294 22.3126C20.2294 22.1103 20.2912 21.8983 20.3619 21.8309C20.4325 21.7635 21.3948 21.1469 22.5072 20.463C24.1847 19.4226 24.5555 19.2299 24.7762 19.2781C25.1029 19.3455 25.4119 19.6538 25.4648 19.9717C25.5708 20.5689 25.4648 20.6749 22.8074 22.5149C21.4125 23.4782 19.4613 24.8365 18.4637 25.5204C16.133 27.1388 15.6209 27.3508 14.5526 27.1388C14.2789 27.081 12.7957 26.4452 11.2507 25.7227L8.4432 24.3934L7.5162 24.3452L6.58919 24.2874L6.5627 21.1084C6.55387 19.3648 6.5627 17.8716 6.58919 17.8138C6.65099 17.6211 9.08769 17.6404 9.7675 17.8331Z"
                    fill="#456386" stroke="#456386" stroke-width="0.5" />
                  <path
                    d="M11.1848 4.3482C9.67421 5.16234 8.32842 5.91083 8.20483 6.01588C7.98511 6.19972 7.95764 6.528 7.95764 9.32497C7.95764 12.1219 7.98511 12.4502 8.20483 12.6472C8.53441 12.9361 13.9038 15.8906 14.0824 15.8906C14.3295 15.8906 19.6715 12.8836 19.8775 12.6472C20.0011 12.4896 20.0423 11.6098 20.0423 9.36436C20.0423 6.60679 20.0148 6.2785 19.7951 6.0684C19.5205 5.81891 14.2472 2.89062 14.0549 2.89062C13.9862 2.89062 12.6954 3.54719 11.1848 4.3482ZM15.95 5.20174C16.9937 5.81891 17.8725 6.37042 17.9 6.42295C17.9412 6.47547 17.0898 7.01386 16.0187 7.63103L14.0686 8.74719L12.0225 7.5785C10.5943 6.75123 10.045 6.37042 10.1686 6.29164C10.2784 6.23911 11.1711 5.71386 12.1461 5.13608C13.1348 4.5583 13.9588 4.08557 13.9862 4.08557C14.0137 4.07244 14.8926 4.58456 15.95 5.20174ZM11.3908 8.51083L13.382 9.66638L13.4232 12.0038C13.4369 13.2906 13.4095 14.3149 13.3408 14.2886C13.2859 14.2755 12.3246 13.7502 11.2123 13.133L9.2073 12.0169L9.19357 9.67951C9.19357 8.40578 9.23477 7.35527 9.30343 7.3684C9.35836 7.3684 10.2922 7.88052 11.3908 8.51083ZM18.8064 9.70578V12.0563L16.8014 13.1856C15.7028 13.8027 14.769 14.3149 14.7415 14.3149C14.7141 14.3149 14.7003 13.2644 14.7141 11.9906L14.7553 9.66638L16.7465 8.51083C17.8451 7.88052 18.7514 7.3684 18.7789 7.3684C18.7926 7.35527 18.8064 8.41891 18.8064 9.70578Z"
                    fill="#456386" />
                </svg>
                <span class="card-title mb-0">{{ ('teamsPage.titles' | translate)[2] }}</span>
              </div>

              <div class="card-content mt-4">
                <!-- <div class="info-row">
                  <span class="label">{{ ('teamsPage.allocated' | translate) }}</span>
                  <div class="progress-container">
                    <div *ngIf="allocated != 0" class="progress-bar allocated"
                      [style.width]="getProgressWidth(allocated)">{{allocated}}</div>
                  </div>
                </div> -->

                <!-- <div class="info-row">
                  <span class="label">{{ ('teamsPage.remainingAllocation' | translate) }}</span>
                  <div class="progress-container">
                    <div *ngIf="remainingAllocation != 0" class="progress-bar remaining"
                      [style.width]="getProgressWidth(remainingAllocation)">{{remainingAllocation}}</div>
                  </div>
                </div> -->
                <span class="onhand">{{totalonHand}}</span>
                <!-- <div class="info-row">
                  <span class="label">{{ ('teamsPage.onHand' | translate) }}</span>
                  <div class="progress-container">
                    <div *ngIf="totalonHand != 0" class="progress-bar on-hand"
                      [style.width]="getProgressWidth(totalonHand)">{{totalonHand}}</div>
                  </div>
                </div> -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <app-team-members (dataProcessed)="handleDataFromChild($event)" [productInfo]="productInfo"></app-team-members>
  </div>